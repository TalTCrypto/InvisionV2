#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ðŸ” Running pre-commit checks..."

# Linter et formatter les fichiers modifiÃ©s uniquement
npx lint-staged || {
  echo "âŒ Lint-staged a Ã©chouÃ©. Veuillez corriger les erreurs."
  exit 1
}

# VÃ©rifier que Prisma est Ã  jour si le schema a changÃ©
if git diff --cached --name-only | grep -q "prisma/schema.prisma"; then
  echo "ðŸ“¦ Formatage du schÃ©ma Prisma..."
  npx prisma format || {
    echo "âŒ Erreur lors du formatage du schÃ©ma Prisma."
    exit 1
  }
  echo "ðŸ“¦ GÃ©nÃ©ration du client Prisma..."
  npm run postinstall || {
    echo "âŒ Erreur lors de la gÃ©nÃ©ration du client Prisma."
    exit 1
  }
  # Ajouter les fichiers gÃ©nÃ©rÃ©s si nÃ©cessaire
  git add prisma/schema.prisma generated/prisma/ 2>/dev/null || true
fi

echo "âœ… Pre-commit checks passed!"
