---
description: "Guide complet pour le d√©veloppement frontend T3 : tRPC React, Server/Client Components, shadcn/ui, nuqs, state management et bonnes pratiques."
globs:
  - "src/app/**/*.{ts,tsx}"
  - "src/components/**/*.{ts,tsx}"
  - "src/hooks/**/*.{ts,tsx}"
  - "src/stores/**/*.{ts,tsx}"
  - "**/*.css"
  - "package.json"
  - "next.config.*"
  - "tailwind.config.*"
  - "tsconfig.json"
alwaysApply: false
---

# Guide Frontend T3 Stack

## üö® R√àGLE ABSOLUE - LIRE EN PREMIER

> **‚ö†Ô∏è OBLIGATOIRE** : Consultez `components_usage_policy.mdc` avant tout d√©veloppement
> 
> **INTERDICTIONS STRICTES** :
> - ‚ùå JAMAIS de HTML brut pour les √©l√©ments UI
> - ‚ùå JAMAIS de r√©invention de composants
> - ‚ùå JAMAIS de cr√©ation sans v√©rifier `src/components/ui/` d'abord
> 
> **OBLIGATOIRE** :
> - ‚úÖ TOUJOURS utiliser les composants existants (60+ disponibles)
> - ‚úÖ TOUJOURS consulter `ui_components_reference.mdc` avant de cr√©er
> - ‚úÖ TOUJOURS demander avant de cr√©er un nouveau composant

## Stack Technique

- **Framework** : Next.js 15+ avec App Router
- **API** : tRPC React (type-safe)
- **Styling** : Tailwind CSS + shadcn/ui
- **State** : Zustand (UI) + Nuqs (query params) + tRPC React Query (server state)
- **Formulaires** : React Hook Form + Zod
- **i18n** : next-intl (internationalisation)
- **Dates** : date-fns (formatage de dates)
- **Icons** : Lucide React
- **Composants UI** : 60+ composants de haute qualit√© dans `src/components/ui/`

---

## 1. Architecture Server/Client Components

### Principe Fondamental
- **Server Components** : Logique m√©tier, acc√®s donn√©es via tRPC, calculs
- **Client Components** : UI interactive, √©v√©nements, state local

### Quand utiliser Server Components
```typescript
// ‚úÖ Server Component (par d√©faut)
// src/app/dashboard/page.tsx
import { api, HydrateClient } from "~/trpc/server";

export default async function DashboardPage() {
  // Appel tRPC c√¥t√© serveur
  const posts = await api.post.getAll({
    page: 1,
    pageSize: 20,
  });

  // Pr√©charger pour le client
  void api.post.getLatest.prefetch();

  return (
    <HydrateClient>
      <DashboardView initialPosts={posts.posts} />
    </HydrateClient>
  );
}
```

### Quand utiliser Client Components
```typescript
// ‚úÖ Client Component - UI interactive
// src/components/features/dashboard/DashboardView.tsx
"use client";

import { useState } from "react";
import { api } from "~/trpc/react";
import { Button } from "~/components/ui/button";

interface DashboardViewProps {
  initialPosts: Post[];
}

export function DashboardView({ initialPosts }: DashboardViewProps) {
  const [isModalOpen, setIsModalOpen] = useState(false);
  
  // Utiliser les donn√©es pr√©charg√©es
  const { data: posts } = api.post.getAll.useQuery(
    { page: 1, pageSize: 20 },
    { initialData: { posts: initialPosts, pagination: {} } }
  );

  return (
    <div>
      <Button onClick={() => setIsModalOpen(true)}>
        Ajouter un post
      </Button>
      {/* UI interactive */}
    </div>
  );
}
```

---

## 2. tRPC React - Utilisation

### Hooks tRPC
```typescript
// src/components/features/posts/PostsList.tsx
"use client";

import { api } from "~/trpc/react";
import { PostCard } from "./PostCard";

export function PostsList() {
  // Query avec pagination
  const { data, isLoading, error } = api.post.getAll.useQuery({
    page: 1,
    pageSize: 20,
    search: "",
  });

  if (isLoading) return <div>Chargement...</div>;
  if (error) return <div>Erreur: {error.message}</div>;

  return (
    <div className="grid gap-4">
      {data?.posts.map((post) => (
        <PostCard key={post.id} post={post} />
      ))}
    </div>
  );
}
```

### Mutations tRPC
```typescript
// src/components/features/posts/CreatePostForm.tsx
"use client";

import { useState } from "react";
import { api } from "~/trpc/react";
import { Button } from "~/components/ui/button";
import { Input } from "~/components/ui/input";

export function CreatePostForm() {
  const [name, setName] = useState("");
  const utils = api.useUtils();

  const createPost = api.post.create.useMutation({
    onSuccess: async () => {
      // Invalider les queries pour refetch
      await utils.post.invalidate();
      setName("");
    },
    onError: (error) => {
      console.error("Erreur:", error.message);
    },
  });

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault();
        createPost.mutate({ name });
      }}
      className="flex gap-2"
    >
      <Input
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder="Nom du post"
      />
      <Button type="submit" disabled={createPost.isPending}>
        {createPost.isPending ? "Cr√©ation..." : "Cr√©er"}
      </Button>
    </form>
  );
}
```

### Suspense avec tRPC
```typescript
// src/components/features/posts/LatestPost.tsx
"use client";

import { api } from "~/trpc/react";

export function LatestPost() {
  // useSuspenseQuery pour Suspense
  const [latestPost] = api.post.getLatest.useSuspenseQuery();

  return (
    <div>
      {latestPost ? (
        <p>Dernier post: {latestPost.name}</p>
      ) : (
        <p>Aucun post</p>
      )}
    </div>
  );
}

// Utilisation avec Suspense
// src/app/posts/page.tsx
import { Suspense } from "react";
import { LatestPost } from "~/components/features/posts/LatestPost";

export default function PostsPage() {
  return (
    <Suspense fallback={<div>Chargement...</div>}>
      <LatestPost />
    </Suspense>
  );
}
```

### Optimistic Updates
```typescript
// src/components/features/posts/PostCard.tsx
"use client";

import { api } from "~/trpc/react";
import { Button } from "~/components/ui/button";

export function PostCard({ post }: { post: Post }) {
  const utils = api.useUtils();

  const deletePost = api.post.delete.useMutation({
    onMutate: async (deletedId) => {
      // Annuler les queries en cours
      await utils.post.getAll.cancel();

      // Snapshot de la valeur pr√©c√©dente
      const previousPosts = utils.post.getAll.getData();

      // Optimistic update
      utils.post.getAll.setData(undefined, (old) => {
        if (!old) return old;
        return {
          ...old,
          posts: old.posts.filter((p) => p.id !== deletedId),
        };
      });

      return { previousPosts };
    },
    onError: (err, deletedId, context) => {
      // Rollback en cas d'erreur
      if (context?.previousPosts) {
        utils.post.getAll.setData(undefined, context.previousPosts);
      }
    },
    onSettled: () => {
      // Refetch pour √™tre s√ªr
      void utils.post.getAll.invalidate();
    },
  });

  return (
    <div>
      <h3>{post.name}</h3>
      <Button
        onClick={() => deletePost.mutate({ id: post.id })}
        disabled={deletePost.isPending}
      >
        Supprimer
      </Button>
    </div>
  );
}
```

---

## 3. State Management

### Zustand - State UI Global
```typescript
// src/stores/uiStore.ts
import { create } from "zustand";
import { devtools } from "zustand/middleware";

interface UIState {
  isSidebarOpen: boolean;
  isModalOpen: boolean;
  modalContent: React.ReactNode | null;
  theme: "light" | "dark" | "system";

  toggleSidebar: () => void;
  openModal: (content: React.ReactNode) => void;
  closeModal: () => void;
  setTheme: (theme: UIState["theme"]) => void;
}

export const useUIStore = create<UIState>()(
  devtools(
    (set) => ({
      isSidebarOpen: true,
      isModalOpen: false,
      modalContent: null,
      theme: "system",

      toggleSidebar: () =>
        set((state) => ({ isSidebarOpen: !state.isSidebarOpen })),

      openModal: (content) =>
        set({ isModalOpen: true, modalContent: content }),

      closeModal: () =>
        set({ isModalOpen: false, modalContent: null }),

      setTheme: (theme) => set({ theme }),
    }),
    { name: "UIStore" }
  )
);
```

### Nuqs - Query Params State
```typescript
// src/hooks/usePostsFilters.ts
import { useQueryState, parseAsString, parseAsInteger } from "nuqs";

export function usePostsFilters() {
  const [search, setSearch] = useQueryState(
    "search",
    parseAsString.withDefault("")
  );
  const [page, setPage] = useQueryState(
    "page",
    parseAsInteger.withDefault(1)
  );
  const [category, setCategory] = useQueryState("category", parseAsString);

  return {
    search,
    setSearch,
    page,
    setPage,
    category,
    setCategory,
    resetFilters: () => {
      setSearch(null);
      setPage(null);
      setCategory(null);
    },
  };
}

// Utilisation avec tRPC
// src/components/features/posts/PostsList.tsx
"use client";

import { api } from "~/trpc/react";
import { usePostsFilters } from "~/hooks/usePostsFilters";

export function PostsList() {
  const { search, page, category } = usePostsFilters();

  const { data } = api.post.getAll.useQuery({
    page,
    pageSize: 20,
    search: search || undefined,
  });

  return (
    <div>
      {/* Liste des posts */}
    </div>
  );
}
```

### Provider Setup
```typescript
// src/app/layout.tsx
import { TRPCReactProvider } from "~/trpc/react";
import { NuqsAdapter } from "nuqs/adapters/next/app";

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="fr">
      <body>
        <TRPCReactProvider>
          <NuqsAdapter>
            {children}
          </NuqsAdapter>
        </TRPCReactProvider>
      </body>
    </html>
  );
}
```

---

## 4. Composants shadcn/ui

### Structure de Composant UI
```typescript
// src/components/ui/button.tsx
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "~/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
  isLoading?: boolean;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  (
    {
      className,
      variant,
      size,
      asChild = false,
      isLoading,
      disabled,
      children,
      ...props
    },
    ref
  ) => {
    const Comp = asChild ? Slot : "button";
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        disabled={disabled || isLoading}
        {...props}
      >
        {isLoading ? (
          <>
            <span className="animate-spin mr-2">‚è≥</span>
            Chargement...
          </>
        ) : (
          children
        )}
      </Comp>
    );
  }
);
Button.displayName = "Button";

export { Button, buttonVariants };
```

### Utilitaire cn
```typescript
// src/lib/utils.ts
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

---

## 5. Formulaires (React Hook Form + Zod)

### Sch√©ma de Validation
```typescript
// src/lib/validations/post.ts
import { z } from "zod";

export const createPostSchema = z.object({
  name: z
    .string()
    .min(3, "Le nom doit contenir au moins 3 caract√®res")
    .max(100, "Le nom ne peut pas d√©passer 100 caract√®res"),
  description: z
    .string()
    .max(500, "La description ne peut pas d√©passer 500 caract√®res")
    .optional(),
});

export type CreatePostInput = z.infer<typeof createPostSchema>;
```

### Composant Formulaire avec tRPC
```typescript
// src/components/features/posts/PostForm.tsx
"use client";

import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { api } from "~/trpc/react";
import { Button } from "~/components/ui/button";
import { Input } from "~/components/ui/input";
import { Textarea } from "~/components/ui/textarea";
import {
  Form,
  FormControl,
  FormDescription,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from "~/components/ui/form";
import { createPostSchema, type CreatePostInput } from "~/lib/validations/post";

interface PostFormProps {
  onSuccess?: () => void;
  defaultValues?: Partial<CreatePostInput>;
}

export function PostForm({ onSuccess, defaultValues }: PostFormProps) {
  const utils = api.useUtils();

  const form = useForm<CreatePostInput>({
    resolver: zodResolver(createPostSchema),
    defaultValues: {
      name: "",
      description: "",
      ...defaultValues,
    },
  });

  const createPost = api.post.create.useMutation({
    onSuccess: async () => {
      await utils.post.invalidate();
      form.reset();
      onSuccess?.();
    },
  });

  const onSubmit = async (data: CreatePostInput) => {
    try {
      await createPost.mutateAsync(data);
    } catch (error) {
      // G√©r√© par tRPC
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-6">
        <FormField
          control={form.control}
          name="name"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Nom</FormLabel>
              <FormControl>
                <Input placeholder="Nom du post" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />

        <FormField
          control={form.control}
          name="description"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Description</FormLabel>
              <FormControl>
                <Textarea
                  placeholder="Description du post"
                  {...field}
                />
              </FormControl>
              <FormDescription>
                Optionnel - Max 500 caract√®res
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        <Button type="submit" isLoading={createPost.isPending}>
          Cr√©er le post
        </Button>
      </form>
    </Form>
  );
}
```

---

## 6. Structure de Projet

### Organisation
```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trpc/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ [trpc]/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ route.ts
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                        # shadcn/ui components
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ button.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ input.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ features/                  # Composants par feature
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ posts/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PostCard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PostForm.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PostsList.tsx
‚îÇ   ‚îî‚îÄ‚îÄ layout/                    # Composants de layout
‚îÇ       ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ       ‚îî‚îÄ‚îÄ Sidebar.tsx
‚îú‚îÄ‚îÄ hooks/                         # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ usePostsFilters.ts
‚îÇ   ‚îî‚îÄ‚îÄ useAuth.ts
‚îú‚îÄ‚îÄ stores/                        # Zustand stores
‚îÇ   ‚îú‚îÄ‚îÄ uiStore.ts
‚îÇ   ‚îî‚îÄ‚îÄ postStore.ts
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ utils.ts                   # Utilitaires
‚îÇ   ‚îî‚îÄ‚îÄ validations/               # Sch√©mas Zod
‚îÇ       ‚îî‚îÄ‚îÄ post.ts
‚îú‚îÄ‚îÄ server/                         # Backend tRPC
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ post.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ root.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ trpc.ts
‚îÇ   ‚îî‚îÄ‚îÄ db.ts
‚îî‚îÄ‚îÄ trpc/                          # tRPC client
    ‚îú‚îÄ‚îÄ react.tsx
    ‚îî‚îÄ‚îÄ server.ts
```

### Path Aliases
```json
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "~/*": ["./src/*"]
    }
  }
}
```

---

## 7. Internationalisation (next-intl)

### Configuration
```typescript
// src/i18n.ts
import { getRequestConfig } from 'next-intl/server';
import { cookies, headers } from 'next/headers';

export const locales = ['fr', 'en'] as const;
export type Locale = (typeof locales)[number];
export const defaultLocale: Locale = 'fr';

export default getRequestConfig(async () => {
  const cookieStore = await cookies();
  const headersList = await headers();
  
  let locale: Locale = defaultLocale;
  
  const localeCookie = cookieStore.get('locale')?.value;
  if (localeCookie && locales.includes(localeCookie as Locale)) {
    locale = localeCookie as Locale;
  } else {
    const acceptLanguage = headersList.get('Accept-Language');
    if (acceptLanguage) {
      const preferred = acceptLanguage.split(',')[0].split('-')[0];
      if (locales.includes(preferred as Locale)) {
        locale = preferred as Locale;
      }
    }
  }
  
  return {
    locale,
    messages: (await import(`./messages/${locale}.json`)).default
  };
});
```

### Utilisation Client
```typescript
// src/components/features/Header.tsx
"use client";

import { useTranslations } from 'next-intl';
import { Button } from "~/components/ui/button";

export function Header() {
  const t = useTranslations('common');
  
  return (
    <header>
      <h1>{t('title')}</h1>
      <Button>{t('actions.save')}</Button>
    </header>
  );
}
```

### Utilisation Server
```typescript
// src/app/dashboard/page.tsx
import { getTranslations } from 'next-intl/server';

export default async function DashboardPage() {
  const t = await getTranslations('dashboard');
  
  return (
    <div>
      <h1>{t('title')}</h1>
    </div>
  );
}
```

### Messages
```json
// src/messages/fr.json
{
  "common": {
    "title": "Mon Application",
    "actions": {
      "save": "Enregistrer",
      "cancel": "Annuler"
    }
  },
  "dashboard": {
    "title": "Tableau de bord"
  }
}
```

---

## 8. Formatage de Dates (date-fns)

### Utilisation
```typescript
// src/components/features/posts/PostCard.tsx
import { format, formatDistanceToNow } from 'date-fns';
import { fr } from 'date-fns/locale';

export function PostCard({ post }: { post: Post }) {
  return (
    <div>
      <p>{format(new Date(post.createdAt), 'PPP', { locale: fr })}</p>
      <p>{formatDistanceToNow(new Date(post.createdAt), { locale: fr, addSuffix: true })}</p>
    </div>
  );
}
```

### Helpers
```typescript
// src/lib/utils/date.ts
import { format, formatDistanceToNow, isToday, isYesterday } from 'date-fns';
import { fr } from 'date-fns/locale';

export function formatPostDate(date: Date | string) {
  const dateObj = typeof date === 'string' ? new Date(date) : date;
  
  if (isToday(dateObj)) {
    return formatDistanceToNow(dateObj, { locale: fr, addSuffix: true });
  }
  
  if (isYesterday(dateObj)) {
    return 'Hier';
  }
  
  return format(dateObj, 'PPP', { locale: fr });
}
```

---

## 9. Server Components avec tRPC

### Pr√©chargement et Hydration
```typescript
// src/app/posts/page.tsx
import { Suspense } from "react";
import { api, HydrateClient } from "~/trpc/server";
import { PostsList } from "~/components/features/posts/PostsList";
import { PostsListSkeleton } from "~/components/skeletons/PostsListSkeleton";

export default async function PostsPage() {
  // Pr√©charger les donn√©es c√¥t√© serveur
  const initialData = await api.post.getAll({
    page: 1,
    pageSize: 20,
  });

  // Pr√©charger pour le client
  void api.post.getLatest.prefetch();

  return (
    <HydrateClient>
      <div className="space-y-6">
        <h1>Posts</h1>
        <Suspense fallback={<PostsListSkeleton />}>
          <PostsList initialData={initialData} />
        </Suspense>
      </div>
    </HydrateClient>
  );
}
```

---

## 10. Error Handling

### Error Boundary
```typescript
// src/app/(dashboard)/error.tsx
"use client";

import { useEffect } from "react";
import { Button } from "~/components/ui/button";

interface ErrorProps {
  error: Error & { digest?: string };
  reset: () => void;
}

export default function DashboardError({ error, reset }: ErrorProps) {
  useEffect(() => {
    console.error("Error:", error);
  }, [error]);

  return (
    <div className="flex flex-col items-center justify-center min-h-[400px] gap-4">
      <h2 className="text-2xl font-bold">Une erreur est survenue</h2>
      <p className="text-muted-foreground">
        {error.message || "Une erreur inattendue s'est produite"}
      </p>
      {error.digest && (
        <p className="text-sm text-muted-foreground">
          R√©f√©rence: {error.digest}
        </p>
      )}
      <Button onClick={reset}>R√©essayer</Button>
    </div>
  );
}
```

### Gestion d'erreurs tRPC
```typescript
// src/components/features/posts/PostsList.tsx
"use client";

import { api } from "~/trpc/react";
import { TRPCClientError } from "@trpc/client";

export function PostsList() {
  const { data, error, isLoading } = api.post.getAll.useQuery({
    page: 1,
    pageSize: 20,
  });

  if (isLoading) return <div>Chargement...</div>;

  if (error) {
    if (error instanceof TRPCClientError) {
      if (error.data?.code === "UNAUTHORIZED") {
        return <div>Vous devez √™tre connect√©</div>;
      }
      if (error.data?.code === "NOT_FOUND") {
        return <div>Post non trouv√©</div>;
      }
    }
    return <div>Erreur: {error.message}</div>;
  }

  return (
    <div>
      {data?.posts.map((post) => (
        <div key={post.id}>{post.name}</div>
      ))}
    </div>
  );
}
```

---

## 11. Performance

### Streaming avec Suspense
```typescript
// src/app/dashboard/page.tsx
import { Suspense } from "react";
import { DashboardStats } from "~/components/features/dashboard/DashboardStats";
import { RecentPosts } from "~/components/features/dashboard/RecentPosts";
import { StatsSkeleton, PostsSkeleton } from "~/components/skeletons";

export default function DashboardPage() {
  return (
    <div className="grid gap-6">
      <Suspense fallback={<StatsSkeleton />}>
        <DashboardStats />
      </Suspense>

      <Suspense fallback={<PostsSkeleton />}>
        <RecentPosts />
      </Suspense>
    </div>
  );
}
```

### Optimisation Images
```typescript
// src/components/ui/optimized-image.tsx
import Image from "next/image";

interface OptimizedImageProps {
  src: string;
  alt: string;
  width?: number;
  height?: number;
  priority?: boolean;
  className?: string;
}

export function OptimizedImage({
  src,
  alt,
  width,
  height,
  priority = false,
  className,
}: OptimizedImageProps) {
  return (
    <Image
      src={src}
      alt={alt}
      width={width}
      height={height}
      priority={priority}
      loading={priority ? "eager" : "lazy"}
      className={className}
    />
  );
}
```

---

## 12. Checklist Frontend

### Structure
- [ ] App Router avec groupes de routes `(folder)`
- [ ] Server Components par d√©faut
- [ ] Client Components avec `"use client"` si n√©cessaire
- [ ] Path aliases `~/` configur√©s
- [ ] Structure layer-based respect√©e

### tRPC
- [ ] Hooks tRPC utilis√©s (`useQuery`, `useMutation`)
- [ ] Pr√©chargement c√¥t√© serveur avec `api.router.procedure.prefetch()`
- [ ] Hydration avec `HydrateClient`
- [ ] Optimistic updates pour mutations
- [ ] Error handling avec TRPCError

### State Management
- [ ] Zustand pour state UI global
- [ ] Nuqs pour query params
- [ ] tRPC React Query pour server state
- [ ] Providers configur√©s dans `layout.tsx`

### Composants
- [ ] shadcn/ui utilis√© pour UI de base
- [ ] Composants features isol√©s
- [ ] Props typ√©es avec TypeScript
- [ ] Variants avec `class-variance-authority`

### Formulaires
- [ ] React Hook Form configur√©
- [ ] Validation Zod
- [ ] Messages d'erreur accessibles
- [ ] Loading states g√©r√©s
- [ ] Int√©gration avec tRPC mutations

### Internationalisation
- [ ] next-intl configur√©
- [ ] Messages fr/en cr√©√©s
- [ ] D√©tection langue (cookies/headers)
- [ ] Utilisation dans composants (useTranslations/getTranslations)

### Dates
- [ ] date-fns install√©
- [ ] Helpers de formatage cr√©√©s
- [ ] Locale configur√©e (fr)

### Performance
- [ ] Streaming avec Suspense
- [ ] Pr√©chargement tRPC c√¥t√© serveur
- [ ] Images optimis√©es (next/image)
- [ ] Fonts optimis√©es (next/font)

### Accessibilit√©
- [ ] Labels et aria-* appropri√©s
- [ ] Navigation clavier fonctionnelle
- [ ] Contraste suffisant
- [ ] Screen reader compatible

---

**R√®gle d'or** : Server Components pour la logique et les donn√©es (via tRPC), Client Components pour l'interactivit√©. Utiliser tRPC React pour toutes les op√©rations API c√¥t√© client. Performance et accessibilit√© sont des priorit√©s.
